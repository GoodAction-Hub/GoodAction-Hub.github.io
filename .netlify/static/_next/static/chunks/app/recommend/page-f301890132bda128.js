(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[683],{5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},6988:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(5155),n=s(5695),i=s(2115),r=s(2231),l=s(7024),o=s(607);async function c(){let e=await fetch("/api/data");if(!e.ok)throw Error("Failed to fetch data: ".concat(e.status," ").concat(e.statusText));return await e.json()}function m(){let e=(0,n.useSearchParams)().get("query")||"",[t,s]=(0,i.useState)([]),[m,d]=(0,i.useState)(!0),[u,h]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=new AbortController;return d(!0),h(null),c().then(t=>{e.signal.aborted||s(t)}).catch(t=>{e.signal.aborted||(console.error(t),h(t instanceof Error?t.message:String(t)))}).finally(()=>{e.signal.aborted||d(!1)}),()=>{e.abort()}},[]);let x=(0,i.useMemo)(()=>t.flatMap(e=>e.events.map(t=>{let s=r.c9.now().setZone("Asia/Shanghai"),a=t.timeline.map(e=>r.c9.fromISO(e.deadline,{zone:t.timezone})).filter(e=>e>s).sort((e,t)=>e.toMillis()-t.toMillis())[0]||r.c9.fromISO(t.timeline[t.timeline.length-1].deadline,{zone:t.timezone}),n=a.toMillis()-s.toMillis();return{item:e,event:t,nextDeadline:a,timeRemaining:n}})),[t]),g=(0,i.useMemo)(()=>new o.A(x,{keys:["item.title","item.description","item.tags","event.place"],threshold:.3}),[x]),b=(0,i.useMemo)(()=>{let t;return(e.trim()&&g?g.search(e.trim()).map(e=>e.item):x).sort((e,t)=>{let s=e.timeRemaining<0,a=t.timeRemaining<0;return s&&!a?1:!s&&a?-1:s&&a?t.timeRemaining-e.timeRemaining:e.timeRemaining-t.timeRemaining})},[x,e,g]);return m?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-600",children:"events.loading"})]})}):u?(0,a.jsx)("div",{className:"min-h-screen p-8",children:(0,a.jsxs)("p",{className:"text-red-600",children:["Failed to load data: ",u]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 bg-[url('/bg.jpg')] bg-cover bg-center bg-no-repeat",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsx)("div",{className:"bg-transparent space-y-4",children:b.map(e=>{let{item:t,event:s}=e;return(0,a.jsx)(l.n,{item:t,event:s},"".concat(s.id))})}),0===b.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDD0D"}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"events.notFound"}),(0,a.jsx)("p",{className:"text-slate-600",children:"events.hint"})]})]})})}function d(){return(0,a.jsx)(i.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(m,{})})}},8157:(e,t,s)=>{Promise.resolve().then(s.bind(s,6988))}},e=>{var t=t=>e(e.s=t);e.O(0,[953,598,874,218,688,366,852,24,441,684,358],()=>t(8157)),_N_E=e.O()}]);